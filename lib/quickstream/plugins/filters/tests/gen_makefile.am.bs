#!/bin/bash

# gen_makefile.am.bs  the .bs stands for bootstrap script.

set -e

cd "$(dirname ${BASH_SOURCE[0]})"

# We must be in the correct directory to run this script.
if [ ! -e ../../../../../package.make.rl ] || [ ! -e sequenceGen.c ] ; then
    echo "Running in wrong directory"
    exit 1
fi

echo "Generating $PWD/makefile.am"


cat << EOF > makefile.am
# This file was generated by running: $0
# It did not have to be, but every *.c file in this
# directory becomes a filter module, so why not.

AM_LDFLAGS = -module -avoid-version -shared

filterdir = \$(pkglibdir)/plugins/filters/tests

filter_LTLIBRARIES =\\
EOF


filters="$(echo *.c)"

for f in $filters ; do
    echo -e " ${f%%.c}.la\\" >> makefile.am
done
echo >> makefile.am

for f in $filters ; do
    echo -e "${f%%.c}_la_SOURCES = ${f}" >> makefile.am
done

echo >> makefile.am

